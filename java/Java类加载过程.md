# Java类加载过程

[TOC]

### 加载阶段

​		在加载阶段把类的字节码文件加载进内存，类加载器包括：启动类加载器，扩展类加载器，应用类加载器，以及用户的自定义类加载器。加载过程，双亲委托模型

1. 通过一个类的全限定名来获取其定义的二进制字节流。
2. 将这个字节流所代表的静态存储结构转化为方法区的运行时数据结构。
3. 在Java堆中生成一个代表这个类的java.lang.Class对象，作为对方法区中这些数据的访问入口。

### 连接阶段

#### 验证

​		确保 `.class` 文件的字节码符合虚拟机要求

- 文件格式验证
- 元数据验证
- 字节码验证
- 符号引用验证

#### 准备

​		为类的静态变量分配内存空间，并初始化

- 基本类型初始化为 0
- 引用类型初始化为 null
- 常量类型，即被 `static` 和 `final` 修饰的变量，初始化为程序中的值

#### 解析

​		把常量池中的符号引用转换为直接引用，即把标识符替换为地址信息

### 初始化阶段

对类的变量进行初始化

1. 声明静态类变量时指定初始值

2. 使用静态代码块为类变量指定初始值

初始化时机

- 创建类的实例，也就是new的方式

- 访问某个类或接口的静态变量，或者对该静态变量赋值

- 调用类的静态方法

- 反射（如Class.forName(“com.shengsiyuan.Test”)）

- 初始化某个类的子类，则其父类也会被初始化

- Java虚拟机启动时被标明为启动类的类（Java Test），直接使用java.exe命令来运行某个主类


